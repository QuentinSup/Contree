-<!DOCTYPE html>
<html>
	<title></title>
	<meta charset="utf-8">
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="initial-scale=1.0">
	<meta name="viewport" content="width=device-width">
	<meta name="author" content="Clevertech EURL">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="resources/games/standard.css">
<body>
	<div id="body">
		
		<ul class="plateau" data-bind="foreach: game.players">
			<li data-bind="attr: { 'class': 'player player' + $index() }">
				<div>
					<h1>
						<span data-bind="text: name"></span>
						<span data-bind="visible: $root.game.dealer() == $data">D</span>
						<span data-bind="visible: $root.game.currentPlayer() == $data">*</span>
					</h1>
					<div data-bind="foreach: hand">
						<div data-bind="attr: { class: 'carte ' + color + ' ' + value + ' ' + ($parent.selectedCard() == $data?'choosed':''), title: value + ' ' + color, style: 'left: +' + $index() * 40 + 'px'}, click: $parent.chooseCard">
							&nbsp;
						</div>
					</div>
				</div>
			</li>
		</ul>

	</div>
</body>

<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/knockout.min.js"></script>
<script type="text/javascript">
	
	(function() {

		var colors = ['Coeurs', 'Piques', 'Trefles', 'Carreaux'];
		var orders = {
			'default': [
				{ name: 'As', value: 11 }, 
				{ name: 'Dix', value: 10 },
				{ name: 'Roi', value: 4 },
				{ name: 'Reine', value: 3 },
				{ name: 'Valet', value: 2 },
				{ name: 'Neuf', value: 0 },
				{ name: 'Huit', value: 0 },
				{ name: 'Sept', value: 0 }
			],
			'atout': [
				{ name: 'Valet', value: 20 },
				{ name: 'Neuf', value: 14 },
				{ name: 'As', value: 11 },
				{ name: 'Dix', value: 10 },
				{ name: 'Roi', value: 4 },
				{ name: 'Reine', value: 3 },
				{ name: 'Huit', value: 0 },
				{ name: 'Sept', value: 0 }
			]
		};

		var players = [];
		var splitOrder = {
			'default': [3, 2, 3]
		};

		var UneCarte = (function() {

			var UneCarte = function(color, value) {
				this.color = color;
				this.value = value;
			}

			return UneCarte

		})();

		var Player = (function() {

			var sort = function() {
				this.hand.sort(function(card1, card2) {
					return card1.color < card2.color;
				});
			};

			var Player = function(name, isHuman) {
				var self = this;
				this.name = ko.observable(name);
				this.hand = ko.observableArray([]);
				this.isHuman = ko.observable(isHuman);
				this.selectedCard = ko.observable();
				this.sort = sort;
				this.chooseCard = function(card, e) {
					self.sort();
					self.selectedCard(card);
				};
			};

			return Player;

		})();

		var Game = (function() {

			var distribute = function(tirage) {
				for(var i = 0; i < splitOrder.default.length; i++) {
					var v = splitOrder.default[i];
					for(var iPlayer = 0; iPlayer < this.players.length; iPlayer++) {
						var hand = this.players[iPlayer].hand();
						for(var k = 0; k < v; k++) {
							hand.push(tirage.splice(0, 1)[0]);
						}
					}
				}
			};

			var start = function() {
				this.distribute(battreJeu(creerJeuVierge()));
				this.dealer(this.players[0]);
				this.currentPlayer(this.players[0]);
			};

			var playCard = function(player, card) {
				this.turnTable.push(card);
			};

			var Game = function(players) {
				this.players = players;
				this.start = start;
				this.turnTable = ko.observableArray([]);
				this.distribute = distribute;
				this.dealer = ko.observable();
				this.currentPlayer = ko.observable();
			};

			return Game;

		})();

		var creerJeuVierge = function() {
			var jeu = [];
			$.each(colors, function(j, color) {
				$.each(orders.default, function(i, value) {
					jeu.push(new UneCarte(color, value.name))
				})		
			});
			return jeu;
		};

		var battreJeu = function(jeu) {
			var nouveauJeu = [];
			var positions = [];
			for(var i = 0; i < jeu.length; i++) {
				positions.push(i);
			}
			do {
				var pos = Math.floor(Math.random() * positions.length);
				nouveauJeu.push(jeu[positions[pos]]);
				positions.splice(pos, 1);
			} while(positions.length > 0)		
			return nouveauJeu;
		};

		var startGame = function(players) {
			var game = new Game(players);
			return game;
		};

		var players = [new Player('Me', true), new Player('Jhon', false), new Player('Cynthia', false), new Player('Kevin', false)];
		game = new Game(players);
		game.start();
		


		ko.applyBindings({
			game: game
		}, $('#body')[0]);

	})();

</script>

</html>
